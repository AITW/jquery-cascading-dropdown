<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>jQuery Cascading Dropdown Plugin Examples</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Stylesheets here -->
        <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.0/css/bootstrap.min.css" />
        <style type="text/css">
        	.bs-docs-example {
        		position: relative;
				margin: 15px 0;
				padding: 39px 19px 14px;
				background-color: #fff;
				border: 1px solid #ddd;
				-webkit-border-radius: 4px;
				-moz-border-radius: 4px;
				border-radius: 4px;
        	}

        	.bs-docs-example:after {
        		content: "Example";
				position: absolute;
				top: -1px;
				left: -1px;
				padding: 3px 7px;
				font-size: 12px;
				font-weight: bold;
				background-color: #f5f5f5;
				border: 1px solid #ddd;
				color: #9da0a4;
				-webkit-border-radius: 4px 0 4px 0;
				-moz-border-radius: 4px 0 4px 0;
				border-radius: 4px 0 4px 0;
        	}
        </style>
        <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.css">
        <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.css">
	</head>
	<body>
		<div class="container">
			<div class="page-header">
				<h1>jQuery Cascading Dropdown <small>Examples</small></h1>
			</div>

			<h4>Basic</h4>
			<p>This is a basic dropdown setup where the second dropdown is dependent on the first dropdown having a value, and the third dropdown is dependent on either the first or second one having a value.</p>

			<div id="example1" class="bs-docs-example">
				<h4>Phone finder</h4>

				<select class="step1" name="screen">
					<option value="">Screen size</option>
					<option value="4">4.0"</option>
					<option value="4.3">4.3"</option>
					<option value="4.7">4.7"</option>
					<option value="5">5.0"</option>
				</select>
				<select class="step2" name="resolution">
					<option value="">Screen resolution</option>
					<option value="540">540p</option>
					<option value="720">720p</option>
					<option value="1080">1080p</option>
				</select>
				<select class="step3" name="storage">
					<option value="">Storage size</option>
					<option value="8">8 GB</option>
					<option value="16">16 GB</option>
					<option value="32">32 GB</option>
					<option value="64">64 GB</option>
				</select>

				<h4>Matches</h4>
				<ul data-bind="foreach: phones, visible: phones().length > 0">
					<li>
						<span data-bind="text: maker"></span>
						<span data-bind="text: model"></span>
					</li>
				</ul>
				<p data-bind="visible: phones().length == 0">No matches</p>
			</div>

			<h6>Code</h6>
			<div>
<pre class="brush: js">$('#example1').cascadingDropdown({
	selectBoxes: [
		{
			selector: '.step1'
		},
		{
			selector: '.step2',
			requires: ['.step1']
		},
		{
			selector: '.step3',
			requires: ['.step1', '.step2'],
			onChange: function(value, requiredValues) {
				// do stuff
			}
		}
	]
});</pre>
			</div>

			<br />

			<h4>Dynamic</h4>
			<p>This example shows how you can create a completely dynamic group of dropdowns. Dropdowns with dependencies will react based on the rules given, and fetch its own list from the server via Ajax. </p>

			<p>You can provide an array of strings or objects, or a function as the dropdown data source.</p>

			<div id="example2" class="bs-docs-example">
				<h4>Phone finder</h4>

				<select class="step1" name="screen">
					<option value="">Screen size</option>
				</select>
				<select class="step2" name="resolution">
					<option value="">Screen resolution</option>
				</select>
				<select class="step3" name="storage">
					<option value="">Storage size</option>
				</select>

				<h4>Matches</h4>
				<ul data-bind="foreach: phones, visible: phones().length > 0">
					<li>
						<span data-bind="text: maker"></span>
						<span data-bind="text: model"></span>
					</li>
				</ul>
				<p data-bind="visible: phones().length == 0">No matches</p>
			</div>

			<h6>Code</h6>
			<div>
<pre class="brush: js">$('#example2').cascadingDropdown({
	selectBoxes: [
		{
			selector: '.step1',
			source: [
				{ label: '4.0"', value: 4 },
				{ label: '4.3"', value: 4.3 },
				{ label: '4.7"', value: 4.7 },
				{ label: '5.0"', value: 5 }
			]
		},
		{
			selector: '.step2',
			requires: ['.step1'],
			source: function(request, response) {
				$.getJSON('/api/resolutions', request, function(data) {
					response($.map(data, function(item) {
						return {
							label: item + 'p',
							value: item
						};
					}));
				});
			}
		},
		{
			selector: '.step3',
			requires: ['.step1', '.step2'],
			requireAll: true,
			source: function(request, response) {
				$.getJSON('/api/storages', request, function(data) {
					response($.map(data, function(item) {
						return {
							label: item + ' GB',
							value: item
						};
					}));
				});
			},
			onChange: function(value, requiredValues){
				// do stuff
			}
		}
	]
});</pre>
			</div>

			<br />

			<h4>Combined</h4>
			<p>This example demonstrates the plugin's capability to combine both static and dynamic dropdowns.</p>

			<div id="example3" class="bs-docs-example">
				<h4>Phone finder</h4>

				<select class="step1" name="screen">
					<option value="">Screen size</option>
					<option value="4">4.0"</option>
					<option value="4.3">4.3"</option>
					<option value="4.7">4.7"</option>
					<option value="5">5.0"</option>
				</select>
				<select class="step2" name="resolution">
					<option value="">Screen resolution</option>
					<option value="540">540p</option>
					<option value="720">720p</option>
					<option value="1080">1080p</option>
				</select>
				<select class="step3" name="storage">
					<option value="">Storage size</option>
				</select>

				<h4>Matches</h4>
				<ul data-bind="foreach: phones, visible: phones().length > 0">
					<li>
						<span data-bind="text: maker"></span>
						<span data-bind="text: model"></span>
					</li>
				</ul>
				<p data-bind="visible: phones().length == 0">No matches</p>
			</div>

			<h6>Code</h6>
			<div>
<pre class="brush: js">$('#example3').cascadingDropdown({
	selectBoxes: [
		{
			selector: '.step1',
			paramName: 'cId'
		},
		{
			selector: '.step2',
			paramName: 'sId'
		},
		{
			selector: '.step3',
			requires: ['.step1', '.step2'],
			requireAll: true,
			url: '/api/offices',
			textKey: 'label',
			valueKey: 'value',
			onChange: function(value){
				alert(value);
			}
		}
	]
});</pre>
			</div>

			<br />

			<p class="text-center"><small>Copyright &copy; 2013 <a href="http://dnasir.com">Dzulqarnain Nasir</a></small></p>
		</div>

		<!-- Scripts here -->
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.3.0/knockout-min.js"></script>
		<script type="text/javascript" src="jquery.mockjax.js"></script>
		<script type="text/javascript" src="jquery.cascadingdropdown.js"></script>
		<script type="text/javascript">
			// Some mockjax code to simulate Ajax calls
			var phoneList = [
				{
					maker: 'HTC',
					model: 'One S',
					screen: 4.3,
					resolution: 540,
					storage: [8, 16]
				},
				{
					maker: 'Samsung',
					model: 'Galaxy S4',
					screen: 5,
					resolution: 1080,
					storage: [16, 32, 64]
				},
				{
					maker: 'HTC',
					model: 'One',
					screen: 4.7,
					resolution: 1080,
					storage: [32, 64]
				},
				{
					maker: 'Motorola',
					model: 'Droid 4',
					screen: 4,
					resolution: 540,
					storage: [8]
				},
				{
					maker: 'Motorola',
					model: 'Droid RAZR HD',
					screen: 4.7,
					resolution: 720,
					storage: [16]
				},
				{
					maker: 'LG',
					model: 'Optimus 4X HD',
					screen: 4.7,
					resolution: 720,
					storage: [16]
				},
				{
					maker: 'HTC',
					model: 'Butterfly',
					screen: 5,
					resolution: 1080,
					storage: [16]
				},
				{
					maker: 'Motorola',
					model: 'Moto X',
					screen: 4.7,
					resolution: 720,
					storage: [16, 32]
				},
			];

			function getPhones(screen, resolution, storage) {
				return $.grep(phoneList, function(item, index) {
					var s = true, r = true, st = true;

					if(screen) {
						s = item.screen == screen;
					}

					if(resolution) {
						r = item.resolution == resolution;
					}

					if(storage) {
						st = item.storage.indexOf(storage) > -1;
					}

					return !!(s && r && st);
				});
			}

			function getScreens(resolution, storage) {
				var phones = getPhones(null, resolution, storage);

				var screens = $.map(phones, function(phone) { return phone.screen; });
				screens.sort(asc);
				return arrayUnique(screens);
			}

			function getResolutions(screen, storage) {
				var phones = getPhones(screen, null, storage);

				var resolutions = $.map(phones, function(phone) { return phone.resolution; });
				resolutions.sort(asc);
				return arrayUnique(resolutions);
			}

			function getStorages(screen, resolution) {
				var phones = getPhones(screen, resolution, null);

				var storages = [];
				$.each(phones, function(index, item) {
					storages = arrayUnique(storages.concat(item.storage));
				});
				storages.sort(asc);
				return storages;
			}

			function arrayUnique(array) {
			    var a = array.concat();
			    for(var i=0; i<a.length; ++i) {
			        for(var j=i+1; j<a.length; ++j) {
			            if(a[i] === a[j])
			                a.splice(j--, 1);
			        }
			    }

			    return a;
			}

			function asc(a, b) {
				return a - b;
			}

			$.mockjax({
				url: '/api/screens',
				contentType: 'application/json; charset=utf-8',
				response: function(settings){
					this.responseText = JSON.stringify(getScreens(parseFloat(settings.data.resolution), parseFloat(settings.data.storage)));
				}
			});

			$.mockjax({
				url: '/api/resolutions',
				contentType: 'application/json; charset=utf-8',
				response: function(settings){
					this.responseText = JSON.stringify(getResolutions(parseFloat(settings.data.screen), parseFloat(settings.data.storage)));
				}
			});

			$.mockjax({
				url: '/api/storages',
				contentType: 'application/json; charset=utf-8',
				response: function(settings){
					this.responseText = JSON.stringify(getStorages(parseFloat(settings.data.screen), parseFloat(settings.data.resolution)));
				}
			});

			$.mockjax({
				url: '/api/phones',
				contentType: 'application/json; charset=utf-8',
				response: function(settings){
					this.responseText = JSON.stringify(getPhones(parseFloat(settings.data.screen), parseFloat(settings.data.resolution), parseFloat(settings.data.storage)));
				}
			});

			var example1Array = ko.observableArray([]);

			ko.applyBindings({
				phones: example1Array
			}, document.getElementById('example1'));

			// Example 1
			$('#example1').cascadingDropdown({
				selectBoxes: [
					{
						selector: '.step1'
					},
					{
						selector: '.step2',
						requires: ['.step1']
					},
					{
						selector: '.step3',
						requires: ['.step1', '.step2'],
						onChange: function(value, requiredValues) {
							var ajaxData = requiredValues;
							ajaxData[this.el.attr('name')] = value;
							$.getJSON('/api/phones', ajaxData, function(data) {
								example1Array(data);
							});
						}
					}
				]
			});

			var example2Array = ko.observableArray([]);

			ko.applyBindings({
				phones: example2Array
			}, document.getElementById('example2'));

			$('#example2').cascadingDropdown({
				selectBoxes: [
					{
						selector: '.step1',
						source: [{ label: '4.0"', value: 4 }, { label: '4.3"', value: 4.3 }, { label: '4.7"', value: 4.7 }, { label: '5.0"', value: 5 }]
					},
					{
						selector: '.step2',
						requires: ['.step1'],
						source: function(request, response) {
							$.getJSON('/api/resolutions', request, function(data) {
								response($.map(data, function(item) {
									return {
										label: item + 'p',
										value: item
									};
								}));
							});
						}
					},
					{
						selector: '.step3',
						requires: ['.step1', '.step2'],
						requireAll: true,
						source: function(request, response) {
							$.getJSON('/api/storages', request, function(data) {
								response($.map(data, function(item) {
									return {
										label: item + ' GB',
										value: item
									};
								}));
							});
						},
						onChange: function(value, requiredValues){
							var ajaxData = requiredValues;
							ajaxData[this.el.attr('name')] = value;
							$.getJSON('/api/phones', ajaxData, function(data) {
								example2Array(data);
							});
						}
					}
				]
			});
			
			var example3Array = ko.observableArray([]);

			ko.applyBindings({
				phones: example3Array
			}, document.getElementById('example3'));

			$('#example3').cascadingDropdown({
				selectBoxes: [
					{
						selector: '.step1'
					},
					{
						selector: '.step2'
					},
					{
						selector: '.step3',
						requires: ['.step1', '.step2'],
						requireAll: true,
						source: function(request, response) {
							$.getJSON('/api/storages', request, function(data) {
								response($.map(data, function(item) {
									return {
										label: item + ' GB',
										value: item,
										selected: (item == 8)
									};
								}));
							});
						},
						onChange: function(value, requiredValues){
							var ajaxData = requiredValues;
							ajaxData[this.el.attr('name')] = value;
							$.getJSON('/api/phones', ajaxData, function(data) {
								example3Array(data);
							});
						}
					}
				],
				onChange: function(data) {
					console.log(data)
				}
			});
		</script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.js"></script>
		<script type="text/javascript">
			SyntaxHighlighter.all();
		</script>
	</body>
</html>